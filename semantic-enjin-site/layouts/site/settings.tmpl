<!DOCTYPE html>
<html lang="{{ .Request.Language }}">
{{ featurePartials "head" "head" }}
{{ template "partials/head.tmpl" . }}
{{ featurePartials "head" "tail" }}
<body
        {{- if .Type }} data-page-type="{{ .Type }}"{{ end -}}
        {{- if .Layout }} data-page-layout="{{ .Layout }}"{{ end -}}
        {{- if .Format }} data-page-format="{{ .Format | replace ".tmpl" }}"{{ end -}}
        {{- if .Archetype }} data-page-archetype="{{ .Archetype }}"{{ end -}}
>
{{ featurePartials "body" "head" }}
{{ template "partials/header.tmpl" . }}
<main data-layout-view="site/settings.tmpl">
    <div id="top"></div>
    {{ template "partials/notices.tmpl" . }}

    <section class="block" id="main-header"
             data-block-tag="main-header"
             data-block-type="header"
             data-block-profile="outer--inner"
             data-block-padding="top"
             data-block-margins="bottom"
             data-header-level="1"
             data-header-count="1"
    >
        <div class="content">
            <header>
                <h1 class="user-summary">
                    {{ _ "Site Settings" }}
                </h1>
            </header>
        </div>
    </section>

    <section class="block" id="user"
             data-block-tag="user"
             data-block-type="header"
             data-block-profile="outer--inner"
             data-block-padding="none"
             data-block-margins="bottom"
             data-header-level="1"
             data-header-count="1"
    >
        <div class="content">
            <header>
                <h2 class="user-summary">
                    {{- if .UserSettings.ProfileImage -}}
                        <a class="profile-image" target="_blank"
                           href="{{ .UserSettings.ProfileImage }}"
                           title="{{ _ "view profile image in new tab" }}"
                        >
                        {{- template "partials/common/img.tmpl" (dict $
                        "Src" (fsUrl .UserSettings.ProfileImage)
                        "Alt" (_ "current profile image")
                        ) -}}
                        </a>
                    {{- else -}}
                        <span class="profile-default"><i class="fa-solid fa-user" title="{{ _ "default user image" }}"></i></span>
                    {{- end -}}
                    <span class="display-name">{{- if .UserSettings.DisplayName }}{{ .UserSettings.DisplayName }}{{- else }}({{ _ "unnamed" }}){{- end -}}</span>
                    <span class="email-address">{{- .UserSettings.Email -}}</span>
                </h2>
            </header>
        </div>
    </section>

    <article class="block" id="settings"
             data-block-tag="settings"
             data-block-type="content"
             data-block-profile="outer--inner"
             data-block-padding="none"
             data-block-margins="both"
             data-block-jump-top="false"
             data-block-jump-link="true"
    >
        <div class="content">
            <section>
                {{ if .SiteSettings }}
                    <form method="post" action="{{ .FormAction }}">
                        {{ template "partials/common/nonces.tmpl" .Nonces }}
                        <table>
                            {{ range $idx,$key := .SiteSettingsKeys }}
                                {{ with $fields := index $.SiteSettings $key }}
                                    <tr><td colspan="3">{{ toCamel $key }}</td></tr>
                                    {{ range $kdx,$key := $fields.SortedKeys }}
                                        {{ with $field := (index $fields $key) }}
                                            <tr>
                                                <td>&nbsp;</td>
                                                <td>{{ $field.Label }}</td>
                                                <td>
                                                    <div class="edit-page--matter--fields--field">
                                                        {{ template "partials/settings/field.tmpl" (dict
                                                        "ReadOnly" false
                                                        "Matter" $.UserSettings
                                                        "Field" $field
                                                        "FieldErrors" $.FieldErrors
                                                        ) }}
                                                    </div>
                                                </td>
                                            </tr>
                                        {{ end }}
                                    {{ end }}
                                {{ end }}
                            {{ end }}
                            {{ if .SiteSettingsPanelKeys }}
                                <tr><td colspan="3">{{ _ "Others" }}</td></tr>
                                {{ range $idx,$label := $.SiteSettingsPanelKeys }}
                                    {{ with $panel := index $.SiteSettingsPanelLookup $label }}
                                        <tr>
                                            <td>&nbsp;</td>
                                            <td>{{ $label }}</td>
                                            <td>
                                                <a class="button caution"
                                                   href="{{ $panel | asURL }}"
                                                >{{ _ "Manage" }}</a>
                                            </td>
                                        </tr>
                                    {{ end }}
                                {{ end }}
                            {{ end }}
                        </table>
                        <div class="form-actions">
                            <button type="submit" name="submit" value="cancel" class="cancel">{{ _ "Cancel" }}</button>
                            <button type="submit" name="submit" value="commit" class="primary">{{ _ "Save" }}</button>
                        </div>
                    </form>
                {{ else }}
                    <p>{{ _ "None of the site's features have user-configurable settings." }}</p>
                {{ end }}
            </section>
        </div>
    </article>

</main>
{{ template "partials/footer.tmpl" . }}
{{ featurePartials "body" "tail" }}
</body>
</html>