{{ $key := .Key }}{{ if and (not $key) (.Action) }}{{ $key = .Action.Key }}{{ end }}
{{ $tag := .Tag }}{{ if not $tag }}{{ $tag = (toKebab $key) }}{{ end }}
{{ $name := .Name }}{{ if and (not $name) (.Action) }}{{ $name = .Action.Name }}{{ end }}
{{ $icon := .Icon }}{{ if and (not $icon) (.Action) }}{{ $icon = .Action.Icon }}{{ end }}
{{ $class := .Class }}{{ if and (not $class) (.Action) }}{{ $class = .Action.Class }}{{ end }}
{{ $title := .Title }}{{ if not $title }}
    {{ if (.Action) }}{{ $title = .Action.Name }}{{ else }}{{ $title = $name }}{{ end }}
{{ end }}
{{ $message := .Message }}{{ if and (not $message) (.Action) }}{{ $message = .Action.Prompt }}{{ end }}

{{ $styles := printf `
#%[1]s, #%[1]s--underlay, #%[1]s--confirmed { display: none; }
#%[1]s--confirmed:checked ~ #%[1]s,
#%[1]s--confirmed:checked ~ #%[1]s--underlay { display: flex; }
` $tag }}
{{ if $.StyleSrcNonceValue }}
    {{ printf `<style nonce="%[2]s">%[1]s</style>` $styles $.StyleSrcNonceValue | asHTML }}
{{ else }}
    {{ printf `<style>%[1]s</style>` $styles | asHTML }}
{{ end }}

<input id="{{ $tag }}--confirmed"
       type="checkbox" style="display:none;"
       name="{{ $key }}-confirmed"
       value="true"
/>

<label id="confirm-{{ $tag }}"
       class="button {{ $class }} fit"
       for="{{ $tag }}--confirmed"
       title="{{ $name }}"
       data-order="{{ .Order }}"
>
    {{ if $icon }}
        <i class="{{ $icon }}"></i>
        <span class="sr-only">{{ $name }}</span>
    {{ end }}
    {{ if or (not $icon) ($.IconWithName) }}
        <span class="action-label">{{ $name }}</span>
    {{ end }}
</label>

<label id="{{ $tag }}--underlay" class="dialog--underlay" for="{{ $tag }}--confirmed">&nbsp;</label>

<div id="{{ $tag }}" class="dialog dialog--create-page">
    <div class="dialog--title">{{ $title }}</div>
    <div class="dialog--body">

        <div class="dialog--body--stack">


            <input id="{{ $tag }}--create--page" name="{{ $key }}~create-mode"
                   type="radio" style="display:none;" value="page"
                   checked
            />
            <input id="{{ $tag }}--create--arch" name="{{ $key }}~create-mode"
                   type="radio" style="display:none;" value="arch"
            />

            {{ printf `
<style>
#%[1]s--create--page:checked ~ .dialog--fields .dialog--fields--dst-archetype { display: none; }
#%[1]s--create--page:checked ~ .dialog--tab-sentence #%[1]s--create--custom--picker {
    color: var(--color--light);
    background-color: var(--color--primary);
    border: 1px solid var(--color--primary);
    border-bottom: none;
}
#%[1]s--create--arch:checked ~ .dialog--fields .dialog--fields--dst-format { display: none; }
#%[1]s--create--arch:checked ~ .dialog--tab-sentence #%[1]s--create--standard--picker {
    color: var(--color--light);
    background-color: var(--color--primary);
    border: 1px solid var(--color--primary);
    border-bottom: none;
}
</style>
` $tag | asHTML }}

            <div class="dialog--tab-sentence">
                {{ with $standardOrCustom := "|" }}
                    {{ with $txmsg := (_ "Create a new %[1]s page:" $standardOrCustom) }}
                        {{ $parts := (splitString $txmsg "|") }}{{ $partc := len $parts }}
                        {{ $before := "" }}{{ if gt $partc 0 }}{{ $before = (trimSpace (index $parts 0)) }}{{ end }}
                        {{ $after  := "" }}{{ if gt $partc 1 }}{{ $after  = (trimSpace (index $parts 1)) }}{{ end }}
                        {{ if ne $before "" }}
                            <span class="before">{{ $before }}</span>
                        {{ end }}
                        <label id="{{ $tag }}--create--standard--picker"
                               for="{{ $tag }}--create--page">{{ _ "standard" }}</label>
                        {{ if and ($.PageArchetypes) (gt (len $.PageArchetypes) 0) }}
                            <label id="{{ $tag }}--create--custom--picker"
                                   for="{{ $tag }}--create--arch">{{ _ "custom" }}</label>
                        {{ end }}
                        {{ if ne $after "" }}
                            <span class="after">{{ $after }}</span>
                        {{ end }}
                    {{ end }}
                {{ end }}
            </div>

            <div class="dialog--fields">

                {{ if eq (len $.AllFsids) 1 }}

                    <input type="text" name="{{ $key }}~dst-fsid" class="dialog--fields--dst-fsid"
                           value="{{ $.FileInfo.FSID }}"
                           title="{{ _ "destination filesystem" }}"
                           readonly
                    />

                {{ else }}
                    <select name="{{ $key }}~dst-fsid" class="dialog--fields--dst-fsid"
                            title="{{ _ "destination filesystem" }}"
                    >
                        {{ range $idx,$fsid := $.AllFsids }}
                            <option value="{{ $fsid }}"
                                    {{ if and ($.FileInfo) (eq $.FileInfo.FSID $fsid) }}selected{{ end }}
                            >{{ $fsid }}</option>
                        {{ end }}
                    </select>

                {{ end }}

                <span class="dialog--fields--separator">://</span>

                {{ $lang := $.FileInfo.Locale.String }}
                <select name="{{ $key }}~dst-lang" class="dialog--fields--dst-lang"
                        title="{{ _ "new page's locale" }}"
                >
                    {{ range $idx,$tag := $.AllLocales }}
                        <option value="{{ $tag }}"
                                {{ if and $lang (eq $lang $tag) }}selected{{ end }}
                        >{{ $tag }}</option>
                    {{ end }}
                    <option value="und"
                            {{ if or (and $lang (eq $lang "und")) (not $lang) }}selected{{ end }}>
                        und
                    </option>
                </select>

                <span class="dialog--fields--separator">/</span>

                <input type="text" name="{{ $key }}~dst-path" class="dialog--fields--dst-path"
                       placeholder="{{ _ "(optional file path)" }}"
                       title="{{ _ "new page's file path" }}"
                       value="{{ $.FileInfo.DirectoryPath }}"
                />

                <span class="dialog--fields--separator">/</span>

                <input type="text" name="{{ $key }}~dst-name" class="dialog--fields--dst-name"
                       placeholder="{{ _ "(required file name)" }}"
                       title="{{ _ "new page's name" }}"
                       value="{{ $.FileInfo.FileName }}"
                />

                <select name="{{ $key }}~dst-format" class="dialog--fields--dst-format"
                        title="{{ _ "new page's format" }}"
                >
                    {{ range $idx,$fmt := pageFormats }}
                        <option value="{{ $fmt }}">.{{ $fmt }}</option>
                    {{ end }}
                </select>

                {{ if $.PageArchetypes }}
                    <select name="{{ $key }}~dst-archetype" class="dialog--fields--dst-archetype"
                            title="{{ _ "new page's archetype" }}">
                        {{ range $idx,$name := $.PageArchetypes }}
                            <option value="{{ $name }}">{{ $name }}</option>
                        {{ end }}
                    </select>
                {{ end }}

            </div>

        </div>

        {{ if $message }}
            <p>{{ $message }}</p>
        {{ end }}
    </div>
    <button class="dialog--button {{ $class }} fit" type="submit" name="submit"
            value="{{ $key }}">{{ _ "Create" }}</button>
    <label class="dialog--button button cancel fit" for="{{ $tag }}--confirmed">{{ _ "Cancel" }}</label>
</div>